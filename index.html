<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Sentence</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(180deg, #0b1b2b 0%, #0c3a2e 45%, #0a2a1f 100%); /* christmassy green */
            overflow: hidden; /* prevent scroll while overlay active */
        }
        /* Welcome overlay */
        .overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(180deg, #0b1b2b 0%, #0c3a2e 45%, #0a2a1f 100%); /* more Christmasy */
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 1;
            transform: scale(1);
            transition: opacity 500ms ease, transform 500ms ease;
        }
        .overlay.hidden {
            opacity: 0;
            transform: scale(1.02);
            pointer-events: none;
        }
        .title {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 0 4px 14px rgba(255,255,255,0.25);
            margin-bottom: 16px;
            animation: popIn 800ms ease both;
        }
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 28px;
            animation: fadeInUp 900ms ease 200ms both;
        }
        .cta {
            padding: 12px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 10px;
            background: linear-gradient(90deg, #E53935, #FF5252);
            color: #fff;
            box-shadow: 0 6px 20px rgba(229,57,53,0.45);
            cursor: pointer;
            transform: translateY(0);
            transition: transform 200ms ease, box-shadow 200ms ease, background 200ms ease;
            animation: fadeInUp 900ms ease 400ms both;
        }
        .cta:hover { transform: translateY(-2px); box-shadow: 0 10px 24px rgba(229,57,53,0.55); background: #D32F2F; }
        .cta:active { transform: translateY(0); }
        .cta::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            box-shadow: 0 0 0px rgba(255,255,255,0);
            animation: pulseGlow 2.4s ease-in-out infinite;
        }

        /* Snowflakes */
        .snow { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
        .flake { position: absolute; top: -10vh; color: #fff; opacity: 0.8; font-size: 1.2rem; animation: fall linear forwards; }
        @keyframes fall {
            0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            100% { transform: translateY(110vh) translateX(20px) rotate(360deg); opacity: 0.9; }
        }
        @keyframes popIn { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes fadeInUp { 0% { transform: translateY(12px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(229,57,53,0.55); }
            50% { box-shadow: 0 0 16px rgba(229,57,53,0.85); }
        }

        /* Decorative branches */
        .branch {
            position: absolute;
            top: -6px;
            width: min(52vw, 620px);
            height: 160px;
            opacity: 0;
            transform: translateY(-12px) scale(1.02);
            filter: drop-shadow(0 6px 14px rgba(0,0,0,0.35));
            animation: branchIn 900ms ease 250ms forwards, sway 7s ease-in-out 1.2s infinite;
            pointer-events: none;
            z-index: 1;
        }
        .branch.left { left: -10px; }
        .branch.right { right: -10px; }
        /* Ornaments twinkle */
        .branch .orn { animation: twinkle 2.2s ease-in-out infinite; opacity: 0.85; }
        .branch .orn:nth-child(2) { animation-delay: 0.6s; }
        .branch .orn:nth-child(3) { animation-delay: 1.2s; }

        @keyframes branchIn {
            0% { opacity: 0; transform: translateY(12px) scale(0.98); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes sway {
            0%, 100% { transform: translateY(0) scale(1) rotate(0deg); }
            50% { transform: translateY(2px) scale(1) rotate(0.6deg); }
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.65; filter: drop-shadow(0 0 0px rgba(255,255,255,0.25)); }
            50% { opacity: 1; filter: drop-shadow(0 0 8px rgba(255,255,255,0.9)); }
        }

        /* Main app styles */
        #box {
            width: 90%;
            max-width: 400px;
            padding: 20px;
            background: linear-gradient(180deg, #0b1b2b 0%, #0c3a2e 45%, #0a2a1f 100%); /* match welcome */
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.25);
            text-align: center;
            transition: transform 400ms ease, opacity 400ms ease;
            position: relative;
            overflow: hidden;
        }
        /* Garland lights around the card */
        #box::before, #box::after {
            content: "";
            position: absolute;
            left: 0; right: 0;
            height: 6px;
            background:
                radial-gradient(circle at 6px 50%, #ff5252 0 3px, transparent 4px),
                radial-gradient(circle at 36px 50%, #ffd54f 0 3px, transparent 4px),
                radial-gradient(circle at 66px 50%, #4fc3f7 0 3px, transparent 4px),
                radial-gradient(circle at 96px 50%, #81c784 0 3px, transparent 4px);
            background-size: 120px 6px;
            animation: lightsRun 3.2s linear infinite;
            opacity: 0.9;
        }
        #box::before { top: 0; }
        #box::after { bottom: 0; }
        @keyframes lightsRun {
            0% { background-position-x: 0; }
            100% { background-position-x: -120px; }
        }
        #sentence {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #ffffff; /* readable on dark */
            text-shadow: 0 2px 10px rgba(0,0,0,0.35);
        }
        button {
            padding: 12px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            background: #007AFF;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.25);
        }
        #newBtn {
            background: linear-gradient(90deg, #E53935, #FF5252); /* same as CTA */
            box-shadow: 0 6px 20px rgba(229,57,53,0.45);
        }
        #newBtn:hover { filter: brightness(1.05); }
        #resetBtn {
            margin-top: 10px;
            padding: 8px 12px;
            font-size: 0.9rem;
            background: #6c757d; /* neutral on dark */
            color: #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        }
        #resetBtn:hover { filter: brightness(1.08); }
        button:disabled { opacity: 0.6; cursor: not-allowed; }

        /* Remaining cards counter */
        #counter {
            position: fixed;
            top: 12px;
            right: 12px;
            padding: 6px 10px;
            font-size: 0.9rem;
            color: #fff;
            background: rgba(12, 58, 46, 0.8);
            border: 1px solid rgba(255,255,255,0.25);
            border-radius: 999px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            z-index: 10000; /* above overlay content */
            backdrop-filter: blur(2px);
        }

        /* Timer container */
        .timer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 14px;
            color: #fff;
        }
        .countdown {
            min-width: 56px;
            text-align: center;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        /* Clock button */
        .clock-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.65);
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            position: relative;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(0,0,0,0.35);
            transition: transform 150ms ease, box-shadow 150ms ease, opacity 150ms ease;
        }
        .clock-btn:hover { transform: translateY(-1px); box-shadow: 0 10px 24px rgba(0,0,0,0.45); }
        .clock-btn:active { transform: translateY(0); }
        .clock-btn.disabled { cursor: not-allowed; opacity: 0.6; }
        /* Clock face ticks */
        .clock-btn::before {
            content: "";
            position: absolute;
            inset: 6px;
            border-radius: 50%;
            background:
                radial-gradient(circle at 50% 6%, rgba(255,255,255,0.75) 0 2px, transparent 3px),
                radial-gradient(circle at 6% 50%, rgba(255,255,255,0.6) 0 2px, transparent 3px),
                radial-gradient(circle at 50% 94%, rgba(255,255,255,0.6) 0 2px, transparent 3px),
                radial-gradient(circle at 94% 50%, rgba(255,255,255,0.6) 0 2px, transparent 3px);
            opacity: 0.8;
        }
        /* Clock hand: base at exact center, rotate around center */
        .hand {
            position: absolute;
            width: 2px;
            height: 26px;
            background: #ffca28;
            top: 50%;
            left: 50%;
            transform-origin: 50% 100%; /* bottom of the hand sits at center */
            transform: translate(-50%, -100%) rotate(0deg);
            filter: drop-shadow(0 0 6px rgba(255,202,40,0.65));
        }
        .clock-running .hand { animation: sweep 5s linear forwards; }
        @keyframes sweep {
            from { transform: translate(-50%, -100%) rotate(0deg); }
            to   { transform: translate(-50%, -100%) rotate(360deg); }
        }

        @keyframes popIn { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes fadeInUp { 0% { transform: translateY(12px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(229,57,53,0.55); }
            50% { box-shadow: 0 0 16px rgba(229,57,53,0.85); }
        }

        /* Decorative branches */
        .branch {
            position: absolute;
            top: -6px;
            width: min(52vw, 620px);
            height: 160px;
            opacity: 0;
            transform: translateY(-12px) scale(1.02);
            filter: drop-shadow(0 6px 14px rgba(0,0,0,0.35));
            animation: branchIn 900ms ease 250ms forwards, sway 7s ease-in-out 1.2s infinite;
            pointer-events: none;
            z-index: 1;
        }
        .branch.left { left: -10px; }
        .branch.right { right: -10px; }
        /* Ornaments twinkle */
        .branch .orn { animation: twinkle 2.2s ease-in-out infinite; opacity: 0.85; }
        .branch .orn:nth-child(2) { animation-delay: 0.6s; }
        .branch .orn:nth-child(3) { animation-delay: 1.2s; }

        @keyframes branchIn {
            0% { opacity: 0; transform: translateY(12px) scale(0.98); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes sway {
            0%, 100% { transform: translateY(0) scale(1) rotate(0deg); }
            50% { transform: translateY(2px) scale(1) rotate(0.6deg); }
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.65; filter: drop-shadow(0 0 0px rgba(255,255,255,0.25)); }
            50% { opacity: 1; filter: drop-shadow(0 0 8px rgba(255,255,255,0.9)); }
        }

        /* Players setup overlay */
        .players-overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9998;
            background: rgba(0,0,0,0.25);
            backdrop-filter: blur(2px);
        }
        .players-card {
            width: 90%;
            max-width: 480px;
            padding: 16px;
            border-radius: 12px;
            background: linear-gradient(180deg, #0b1b2b 0%, #0c3a2e 45%, #0a2a1f 100%);
            border: 2px solid rgba(255,255,255,0.15);
            color: #fff;
            box-shadow: 0 8px 24px rgba(0,0,0,0.25);
        }
        .players-header { font-weight: 700; margin-bottom: 10px; }
        .player-row { display: flex; gap: 8px; margin-bottom: 8px; }
        .player-row input {
            flex: 1;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.25);
            background: rgba(255,255,255,0.08);
            color: #fff;
        }
        .players-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px; }
        .players-actions button { padding: 8px 12px; border-radius: 8px; }

        /* Current turn badge */
        #currentTurn {
            margin-top: 10px;
            color: #ffca28;
            font-weight: 700;
        }
        /* Award buttons */
        #awardControls {
            display: none;
            margin-top: 10px;
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        #btnSuccess { background: linear-gradient(90deg, #2ecc71, #27ae60); }
        #btnFail { background: linear-gradient(90deg, #e0e0e0, #bdbdbd); color: #222; }
        /* Leaderboard */
        #leaderboard {
            margin-top: 10px;
            color: #fff;
            font-size: 0.95rem;
        }
        #leaderboard .row {
            display: flex;
            justify-content: space-between;
            padding: 4px 8px;
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 6px;
            background: rgba(255,255,255,0.06);
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <!-- Welcome overlay -->
    <div id="welcome" class="overlay">
        <!-- Snowflakes background -->
        <div class="snow" aria-hidden="true">
            <!-- minimal flakes -->
            <span class="flake" style="left:5%; animation-duration: 8s; animation-delay: 0s;">✦</span>
            <span class="flake" style="left:20%; animation-duration: 9s; animation-delay: 1s;">❄</span>
            <span class="flake" style="left:35%; animation-duration: 7s; animation-delay: 0.5s;">✦</span>
            <span class="flake" style="left:50%; animation-duration: 10s; animation-delay: 0.8s;">❄</span>
            <span class="flake" style="left:65%; animation-duration: 9.5s; animation-delay: 0.2s;">✦</span>
            <span class="flake" style="left:80%; animation-duration: 8.5s; animation-delay: 1.2s;">❄</span>
            <span class="flake" style="left:92%; animation-duration: 7.5s; animation-delay: 0.7s;">✦</span>
        </div>

        <!-- Decorative pine branches with ornaments -->
        <svg class="branch left" viewBox="0 0 400 160" aria-hidden="true" preserveAspectRatio="none">
            <!-- branch spine -->
            <g stroke="#1b5e20" stroke-width="10" stroke-linecap="round" fill="none" opacity="0.9">
                <path d="M 0 60 C 110 25, 220 25, 380 70"/>
            </g>
            <!-- needles -->
            <g fill="#2e7d32">
                <rect x="10" y="50" width="170" height="10" rx="5" transform="rotate(-18 10 50)"/>
                <rect x="40" y="68" width="180" height="10" rx="5" transform="rotate(-12 40 68)"/>
                <rect x="80" y="84" width="170" height="10" rx="5" transform="rotate(-6 80 84)"/>
                <rect x="130" y="96" width="160" height="10" rx="5" transform="rotate(2 130 96)"/>
                <rect x="190" y="106" width="140" height="10" rx="5" transform="rotate(8 190 106)"/>
            </g>
            <!-- ornaments -->
            <g>
                <circle class="orn" cx="95"  cy="42" r="8" fill="#e53935"/>
                <circle class="orn" cx="185" cy="56" r="8" fill="#ffca28"/>
                <circle class="orn" cx="270" cy="78" r="8" fill="#29b6f6"/>
            </g>
        </svg>

        <svg class="branch right" viewBox="0 0 400 160" aria-hidden="true" preserveAspectRatio="none">
            <g transform="scale(-1,1) translate(-400,0)">
                <g stroke="#1b5e20" stroke-width="10" stroke-linecap="round" fill="none" opacity="0.9">
                    <path d="M 0 60 C 110 25, 220 25, 380 70"/>
                </g>
                <g fill="#2e7d32">
                    <rect x="10" y="50" width="170" height="10" rx="5" transform="rotate(-18 10 50)"/>
                    <rect x="40" y="68" width="180" height="10" rx="5" transform="rotate(-12 40 68)"/>
                    <rect x="80" y="84" width="170" height="10" rx="5" transform="rotate(-6 80 84)"/>
                    <rect x="130" y="96" width="160" height="10" rx="5" transform="rotate(2 130 96)"/>
                    <rect x="190" y="106" width="140" height="10" rx="5" transform="rotate(8 190 106)"/>
                </g>
                <g>
                    <circle class="orn" cx="95"  cy="42" r="8" fill="#e53935"/>
                    <circle class="orn" cx="185" cy="56" r="8" fill="#ffca28"/>
                    <circle class="orn" cx="270" cy="78" r="8" fill="#29b6f6"/>
                </g>
            </g>
        </svg>

        <h1 class="title">Masz 5 sekund!</h1>
        <div class="subtitle">Super duper gra dla Brzusków</div>
        <button class="cta" id="continueBtn">Kontynuuj</button>
    </div>

    <!-- Players setup overlay -->
    <div id="playersOverlay" class="players-overlay" aria-modal="true" role="dialog">
        <div class="players-card">
            <div class="players-header">Dodaj graczy (max 8)</div>
            <div id="playersList">
                <!-- dynamic input rows -->
            </div>
            <div class="players-actions">
                <button id="addPlayerBtn">Dodaj gracza</button>
                <button id="startGameBtn" class="cta" style="padding:8px 12px;">Start</button>
            </div>
        </div>
    </div>

    <!-- Counter badge -->
    <div id="counter">Pozostałe: 0</div>

    <div id="box">
        <div id="sentence">Naciśnij przycisk ↓</div>
        <button id="newBtn" onclick="showRandom()">Losuj</button>
        <button id="resetBtn" onclick="resetGame()">Resetuj</button>

        <!-- 5s Timer UI -->
        <div class="timer">
            <button id="clockBtn" class="clock-btn" aria-label="Start 5s timer">
                <span class="hand"></span>
            </button>
            <div id="countdown" class="countdown">5s</div>
        </div>

        <!-- Current turn and award controls -->
        <div id="currentTurn">Tura: —</div>
        <div id="awardHint" style="display:none;">Przyznaj punkt (po zakończeniu timera)</div>
        <div id="awardControls">
            <button id="btnSuccess">Sukces (+1)</button>
            <button id="btnFail">Nie udało (0)</button>
        </div>

        <!-- Leaderboard -->
        <div id="leaderboard"></div>

        <!-- Scoreboard -->
        <div id="scoreboard"></div>
    </div>

    <script>
        const sentences = [
            "Wymień 3 przedmioty w pokoju Stacha",
            "Wymień 3 przedmioty w pokoju Misi",
            "Wymień 3 przedmioty w pokoju Rodziców",
            "Wymień 3 produkty, które teraz są w lodówce",
            "Ile jest krzeseł w domu (możesz pomylić się o 2)",
            "Wymień 3 cechy charakteru Stacha",
            "Wymień 3 cechy charakteru Alberta",
            "Wymień 3 cechy charakteru Misi",
            "Wymień 3 cechy charakteru Taty",
            "Wymień 3 cechy charakteru Mamy",
            "Ile figurek stoi na kominku (możesz pomylić się o 2)",
            "Ile kilometrów jest do lasu (możesz pomylić się o 5)",
            "Ile samochodów miała Mama",
            "Ile samochodów miał Albert",
            "Ile samochodów miał Tata",
            "Ile palców kotów jest obecnie w domu",
            "Wymień trzy rzeczy, których nie powinno się wlewać do zbiornika na płyn chłodniczy",
            "Wymień 3 ulubione sklepy Mamy",
            "Wymień 3 państwa, w których rodzice jeszcze nie byli",
            "Wymień 3 państwa, w których Albert I Misia byli razem",
            "Wymień 3 restauracje w Poznaniu",
            "Wymień 3 koleżanki Misi",
            "Wymień 3 kolegów Wojtka",
            "Wymień 3 kolegów Stasia",
            "Wymień 3 kolegów Alberta",
            "Wymień 3 zasady wkładania naczyń do zmywarki",
            "Wymień 3 miejsca, na których byliśmy na wakacjach rodzinnych",
            "Wymień 3 aktywności niedzielne Taty",
            "Wymień 3 aktywności niedzielne Mamy",
            "Wymień 3 najlepsze potrawy Mamy",
            "Wymień 3 plany na przyszłość Alberta",
            "Wymień 3 plany na przyszłość Stasia",
            "Ile lat zostało Tacie do emerytury (możesz pomylić się o 2)",
            "Wymień wszystkie kierunki studiów, na którch była Misia",
            "Wymień 3 plusy mieszkania w piwnicy",
            "Wymień 3 minusy mieszkania w piwnicy",
            "Wymień 3 aktorki, do których podobna jest Misia",
            "Wymień 3 fryzury, które miała Mama",
            "Wymień 3 ulubione drużyny piłkarskie Stasia",
            "Wymień 3 ulubione drużyny piłkarskie Taty",
            "Wymień 3 miejsca, z których mamy kubek na espresso",
            "Ile przycisków jest na ekspresie do kawy",
            "Wymień 3 rzeczy, których nie można robić w kuchni",
            "Ile zdjęć wisi na ścianie, nad kanapą w salonie (możesz pomylić się o 3)",
            "Wymień 3 metody wychowawcze rodziców",
            "Wymień 3 sposoby na otworzenie domu jak nie masz kluczy",
            "Wymień 3 sposoby na popsucie auta mamy",
            "Wymień 3 miasta, w których mieszkał Albert",
            "Wymień imiona 3 sióstr Alberta",
            "Podaj numer buta Stasia",
            "Podaj numer buta Taty",
            "Podaj numer buta Misi",
            "Podaj numer buta Mamy",
            "Podaj numer buta Alberta",
            "Wymień 3 ulubione aktywności Babci Ani",
            "Wymień 3 ulubione aktywności Babci Ewy",
            "Wymień 3 hobby Alberta",
            "Wymień 3 gry, w które gra Stasiu",
            "Wymień 3 kuzynów Stasia i Misi",
            "Wymień 3 zdania, które najczęściej mówi Misia",
            "Wymień 3 zdania, które najczęściej mówi Stasiu",
            "Wymień 3 zdania, które najczęściej mówi Mama",
            "Wymień 3 zdania, które najczęściej mówi Tata",
            "Wymień 3 zdania, które najczęściej mówi Dziadek",
            "Wymień 3 zdania, które najczęściej mówi Babcia Ania",
            "Wymień 3 zdania, które najczęściej mówi Babcia Ewa",
            "Wymień 3 role, które zagrała Misia",
            "Wymień 3 firmy, w których pracował Albert",
            "Wymień 3 firmy, w których pracował Tata",
            "Wymień 3 firmy, w których pracowała Mama",
            "Wymień 3 składniki, z których śniadanie robi Stasiu",
            "Wymień 3 składniki, z których śniadanie robi Misia",
            "Wymień 3 składniki, z których śniadanie robi Tata",
            "Wymień 3 składniki, z których śniadanie robi Mama",
            "Wymień 3 składniki, z których śniadanie robi Albert",
            "Wymień 3 rzeczy, które Misia wyniosłaby z pożaru jako pierwsze",
            "Wymień 3 rzeczy, które Mama wyniosłaby z pożaru jako pierwsze",
            "Wymień 3 rzeczy, które Stasiu wyniósłby z pożaru jako pierwsze",
            "Wymień 3 rzeczy, które Tata wyniósłby z pożaru jako pierwsze",
            "Wymień 3 rzeczy, które Albert wyniósłby z pożaru jako pierwsze",
            "Wymień 3 rzeczy, których nie spodziewa się teraz Misia",
            "Wymień 3 rzeczy, których nie spodziewa się teraz Mama",
            "Wymień 3 rzeczy, których nie spodziewa się teraz Tata",
            "Wymień 3 rzeczy, których nie spodziewa się teraz Stasiu",
            "Wymień 3 rzeczy, których nie spodziewa się teraz Albert",
            "Wymień 3 rzeczy, które rymują się z Brzuska",
            "Wymień 3 rzeczy, które rymują się z Albert",
            "Wymień 3 rzeczy, które rymują się z Stasiu",
            "Wymień 3 rzeczy, które rymują się z Ala",
            "Wymień 3 rzeczy, które rymują się z Wojtek",
            "Wymień 3 rzeczy, które rymują się z Kloc",
            "Wymień 3 rzeczy, których definicji nie zna Tata",
            "Wymień 3 rzeczy, których definicji nie zna Mama",
            "Wymień 3 rzeczy, których definicji nie zna Misia",
            "Wymień 3 rzeczy, których definicji nie zna Stasiu",
            "Wymień 3 rzeczy, których definicji nie zna Albert",
            "Powiedz jak nazywałaby się biografia Alberta",
            "Powiedz jak nazywałaby się biografia Stasia",
            "Powiedz jak nazywałaby się biografia Taty",
            "Powiedz jak nazywałaby się biografia Mamy",
            "Powiedz jak nazywałaby się biografia Misi",
            "Powiedz ile jest książek na półce w domu (możesz pomylić się o dwie)",
            "Powiedz ile jest schodów w domu (możesz pomylić się o dwa)",
            "Powiedz ile jest grafik, obrazów w domu (możesz się pomylić o dwa)",
            "Powiedz ile jest okien w domu (możesz się pomylić o dwa)",
            "Powiedz ile jest geniuszów w domu (możesz się pomylić o dwa)",
            "Powiedz ile jest naturalnych talentów w domu (możesz się pomylić o dwa)",
            "Powiedz ile jest ofiar losu w domu (możesz się pomylić o dwa)",
            "Powiedz ile jest łamag w domu (możesz się pomylić o dwa)",
            "Powiedz ile razy miesięcznie używa się sauny (możesz pomylić się o dwa)",
            "Wymień 3 powody, dla których Misia i Albert są dla siebie idealni",
            "Wymień 3 powody, dla których Misia i Stasiu są siblings goals",
            "Wymień 3 powody, dla których Mama i Tata są dla siebie idealni",
            "Wymień 3 powody, dla których Stasiu i Albert są dla siebie idealni",
            "Wymień 3 najlepsze miejsca na Cytadeli",
            "Wymień 3 sposoby na zabicie czasu w korku do pociągu przez góry w Austrii",
            "Wymień 3 ustawy, które przeszły bez wiedzy Taty",
            "Wymień 3 osoby mądrzejsze od Hugo",
            "Wymień 3 wady wakacji na jachcie",
            "Wymień 3 przedmioty na studiach Stasia",
            "Wymień 3 przedmioty na studiach Misi",
            "Wymień 3 aktywności podczas wyjazdu na narty",
            "Wymień 3 sposoby na szybkie sprzątanie po imprezie sylwestrowej",
            "Wymień 3 przedmioty, które zabrałby Stasiu na bezludną wyspę",
            "Wymień 3 przedmioty, które zabrałaby Misia naa bezludną wyspę",
            "Wymień 3 przedmioty, które zabrałby Tata na bezludną wyspę",
            "Wymień 3 przedmioty, które zabrałaby Mama na bezludną wyspę",
            "Wymień 3 przedmioty, które zabrałby Albert na bezludną wyspę",
            "Wymień 3 rzeczy, które można znaleźć w samochodzie Taty",
            "Wymień 3 rzeczy, które można znaleźć w samochodzie Mamy",
            "Wymień 3 rzeczy, które można znaleźć w samochodzie Alberta","
        ];

        // Shrinking pool to avoid repeats
        let pool = [];
        function resetGame() {
            pool = sentences.slice();
            document.getElementById('newBtn').disabled = false;
            document.getElementById('sentence').innerText = 'Naciśnij przycisk ↓';
            // update counter
            document.getElementById('counter').innerText = `Pozostałe: ${pool.length}`;

            // Visual feedback on reset
            const box = document.getElementById('box');
            box.style.transition = 'transform 250ms ease';
            box.style.transform = 'scale(1.02)';
            setTimeout(() => { box.style.transform = 'scale(1)'; }, 200);
        }

        // Initialize on load
        resetGame();

        function showRandom() {
            if (pool.length === 0) {
                document.getElementById('sentence').innerText = 'Brak zdań. Naciśnij „Resetuj”.';
                document.getElementById('newBtn').disabled = true;
                return;
            }
            const idx = Math.floor(Math.random() * pool.length);
            const picked = pool.splice(idx, 1)[0]; // remove to avoid repeats
            document.getElementById('sentence').innerText = picked;
            // update counter
            document.getElementById('counter').innerText = `Pozostałe: ${pool.length}`;

            if (pool.length === 0) {
                document.getElementById('newBtn').disabled = true;
            }
        }

        // Timer state
        let timerActive = false;
        let timerId = null;

        // Shared AudioContext to avoid autoplay issues and uneven sound
        let audioCtx = null;
        function ensureAudioCtx() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume().catch(() => {});
            }
            return audioCtx;
        }

        // WebAudio beep
        function beep() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.value = 880; // A5
                gain.gain.value = 0.0001; // start near zero to avoid pop
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();

                // quick envelope
                gain.gain.linearRampToValueAtTime(0.15, ctx.currentTime + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.25);

                osc.stop(ctx.currentTime + 0.26);
                osc.onended = () => ctx.close();
            } catch (e) {
                // silent fail if audio not allowed
            }
        }

        // Consistent short click per second
        function clickSound() {
            const ctx = ensureAudioCtx();
            try {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(1200, ctx.currentTime);
                gain.gain.setValueAtTime(0.0001, ctx.currentTime);
                osc.connect(gain);
                gain.connect(ctx.destination);

                const t0 = ctx.currentTime + 0.0;
                // tight, clicky envelope
                gain.gain.linearRampToValueAtTime(0.12, t0 + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.001, t0 + 0.08);

                osc.start(t0);
                osc.stop(t0 + 0.09);
            } catch (e) {}
        }

        // Pronounced final sound at 0s
        function finalSound() {
            const ctx = ensureAudioCtx();
            try {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(750, ctx.currentTime);
                gain.gain.setValueAtTime(0.0001, ctx.currentTime);
                osc.connect(gain);
                gain.connect(ctx.destination);

                const t0 = ctx.currentTime + 0.0;
                // stronger envelope
                gain.gain.linearRampToValueAtTime(0.25, t0 + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.001, t0 + 0.5);
                // gentle upward bend
                osc.frequency.exponentialRampToValueAtTime(900, t0 + 0.15);

                osc.start(t0);
                osc.stop(t0 + 0.52);
            } catch (e) {}
        }

        function setCountdownText(msLeft) {
            const sec = Math.ceil(msLeft / 1000);
            document.getElementById('countdown').innerText = `${sec}s`;
        }

        function startTimer() {
            if (timerActive) return;
            timerActive = true;
            ensureAudioCtx(); // create/resume on user interaction

            const clockBtn = document.getElementById('clockBtn');
            const newBtn = document.getElementById('newBtn');
            const resetBtn = document.getElementById('resetBtn');

            // Disable actions during countdown
            clockBtn.classList.add('clock-running', 'disabled');
            clockBtn.disabled = true;
            newBtn.disabled = true;
            resetBtn.disabled = true;

            const total = 5000;
            const start = performance.now();
            setCountdownText(total);

            let lastWholeSec = 5;

            timerId = requestAnimationFrame(function tick(now) {
                const elapsed = now - start;
                const left = Math.max(0, total - elapsed);
                const sec = Math.ceil(left / 1000);

                // play clicks on second boundaries (4,3,2,1)
                if (sec < lastWholeSec && sec > 0) {
                    clickSound();
                }
                setCountdownText(left);
                lastWholeSec = sec;

                if (left > 0) {
                    timerId = requestAnimationFrame(tick);
                } else {
                    // ensure audio context is active then play final sound
                    ensureAudioCtx();
                    finalSound();

                    document.getElementById('countdown').innerText = '0s';
                    clockBtn.classList.remove('clock-running', 'disabled');
                    clockBtn.disabled = false;
                    // Re-enable buttons depending on pool
                    newBtn.disabled = pool.length === 0;
                    resetBtn.disabled = false;
                    timerActive = false;
                }
            });
        }

        // Hook up clock press
        document.getElementById('clockBtn').addEventListener('click', startTimer);

        // Keep countdown text in sync after reset
        const originalReset = resetGame;
        resetGame = function() {
            originalReset();
            document.getElementById('countdown').innerText = '5s';
            const clockBtn = document.getElementById('clockBtn');
            clockBtn.classList.remove('clock-running', 'disabled');
            clockBtn.disabled = false;
            timerActive = false;
            if (timerId) { cancelAnimationFrame(timerId); timerId = null; }
            // resume audio after any user interaction
            if (audioCtx && audioCtx.state === 'suspended') {
                audioCtx.resume().catch(() => {});
            }
        };

        // Queue state
        let players = [];
        const MAX_PLAYERS = 8;
        let currentTurn = 0;
        let canAward = false;

        // Render current turn
        function renderCurrentTurn() {
            const el = document.getElementById('currentTurn');
            if (players.length === 0) { el.innerText = 'Tura: —'; return; }
            const p = players[currentTurn % players.length];
            el.innerText = `Tura: ${p.name || 'Gracz ' + (currentTurn+1)}`;
        }

        // Advance turn (looped)
        function nextTurn() {
            if (players.length > 0) {
                currentTurn = (currentTurn + 1) % players.length;
                renderCurrentTurn();
            }
        }

        // Scoreboard (unchanged structure, auto-updates points)
        function renderScoreboard() {
            const board = document.getElementById('scoreboard');
            board.innerHTML = '';
            players.forEach((p, i) => {
                const item = document.createElement('div');
                item.className = 'player-btn';
                item.innerHTML = `<span class="player-name">${p.name || 'Gracz ' + (i+1)}</span><span class="player-points">${p.points}</span>`;
                board.appendChild(item);
            });
            renderLeaderboard();
        }

        // Leaderboard (sorted by points desc)
        function renderLeaderboard() {
            const lb = document.getElementById('leaderboard');
            const sorted = [...players].sort((a,b) => b.points - a.points);
            lb.innerHTML = '<div style="font-weight:700; margin-bottom:6px;">Tabela wyników</div>';
            sorted.forEach(p => {
                lb.innerHTML += `<div class="row"><span>${p.name}</span><span>${p.points}</span></div>`;
            });
        }

        // Players overlay control (keep existing, but set up turn after start)
        // ...existing code for playersOverlay, addPlayerBtn, startGameBtn...
        const startGameBtn = document.getElementById('startGameBtn');
        startGameBtn.addEventListener('click', () => {
            // ...existing player filtering...
            currentTurn = 0;
            renderScoreboard();
            renderCurrentTurn();
            // ...existing hide overlay...
        });

        // Award flow tied to timer end
        function setCanAward(val) {
            canAward = val;
            document.getElementById('awardHint').style.display = val ? 'block' : 'none';
            document.getElementById('awardControls').style.display = val ? 'flex' : 'none';
        }

        // Hook Losuj to require timer completion before awarding
        const originalShowRandom = showRandom;
        showRandom = function() {
            originalShowRandom();
            setCanAward(false);
        };

        // Enable awarding after timer finishes (countdown = 0s)
        const countdownEl = document.getElementById('countdown');
        const observer = new MutationObserver(() => {
            if (countdownEl.innerText === '0s') {
                setCanAward(true);
            }
        });
        observer.observe(countdownEl, { childList: true });

        // Award buttons: apply score to current player, then advance turn
        document.getElementById('btnSuccess').addEventListener('click', () => {
            if (!canAward || players.length === 0) return;
            players[currentTurn].points += 1;
            renderScoreboard();
            setCanAward(false);
            nextTurn();
        });
        document.getElementById('btnFail').addEventListener('click', () => {
            if (!canAward || players.length === 0) return;
            // no points
            renderScoreboard();
            setCanAward(false);
            nextTurn();
        });

        // Reset deck should not clear points or queue; just refresh UI
        const originalReset = resetGame;
        resetGame = function() {
            originalReset();
            renderScoreboard();
            renderCurrentTurn();
            setCanAward(false);
        };

        // Initial UI
        renderScoreboard();
        renderCurrentTurn();

        // Welcome overlay logic
        const welcome = document.getElementById('welcome');
        const continueBtn = document.getElementById('continueBtn');
        continueBtn.addEventListener('click', () => {
            welcome.classList.add('hidden');
            // allow scroll if needed after dismiss
            document.body.style.overflow = 'auto';
        });
    </script>
</body>
</html>
